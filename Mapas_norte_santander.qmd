---
title: "Análisis Espacial de Indicadores en los Municipios del Departamento de Norte de Santander"
author: 
  - name: Sofía Duque Rendón 
  - name: Melany Franco Marin 
  - name: Juan David Trejos
  - name: Miguel Ángel Vargas Valencia
date: last-modified
date-format: full
lang: es
format: 
  html:
    toc: true
editor: source
execute: 
  echo: false
  warning: false
---

# Introducción

El presente trabajo tiene como propósito explorar y visualizar espacialmente tres dimensiones clave del desarrollo territorial en el departamento de Norte de Santander, Colombia. A través de mapas temáticos, se analiza la distribución de la pobreza en sus municipios (utilizando indicadores como el Índice de Pobreza Multidimensional), el comportamiento del índice de desempeño fiscal y la distancia de cada municipio con respecto a la capital departamental, Cúcuta.

Estos aspectos permiten identificar desigualdades socioeconómicas y posibles relaciones entre la ubicación geográfica, la capacidad fiscal de los gobiernos locales y las condiciones de vida de la población.

# Objetivos

## Objetivo general

Analizar la distribución espacial de variables sociales, fiscales y geográficas en los municipios del departamento de Norte de Santander mediante representaciones cartográficas.

## Objetivos específicos

-   Representar la distribución de la pobreza en los municipios del departamento.

-   Visualizar el desempeño fiscal de los municipios para identificar diferencias en la gestión de recursos públicos.

-   Calcular y representar la distancia geográfica entre cada municipio y la capital departamental (Cúcuta).

-   Facilitar la interpretación de patrones espaciales que puedan incidir en el desarrollo regional.

```{r}
library(sf)
library(dplyr)
library(ggplot2)
library(stringr)
library(leaflet)
library(geosphere)

```

# Norte de Santander

```{r}
# Mapa con las coordenadas de los municipios
mapa <- st_read("Municipios/Municipios.shp")

mapaColombia <- mapa %>%
  mutate(
    departamento = if_else(DPTO_CCDGO == "54", "Norte de Santander", "Otros departamentos")
  )

# Graficar con leyenda
ggplot(mapaColombia) +
  geom_sf(aes(fill = departamento, color = departamento), size = 0.3) +
  scale_fill_manual(
    values = c("Norte de Santander" = "steelblue", "Otros departamentos" = "gray90"),
    name = "Departamento"
  ) +
  scale_color_manual(
    values = c("Norte de Santander" = "steelblue", "Otros departamentos" = "gray90"),
    name = "Departamento"
  ) +
  labs(
    title = "Norte de Santander"
  ) +
  theme_minimal()
```

Norte de Santander es un departamento colombiano ubicado en la región andina, fronterizo con Venezuela al norte y este, y colindante con los departamentos de Santander, Boyacá y Cesar al oeste y sur. Su extensión territorial es de aproximadamente 21 900 km², distribuidos en 40 municipios, y cuenta con una población estimada de entre 1.6 y 1.7 millones de habitantes , con una densidad demográfica en torno a los 76 hab/km². Su capital es San José de Cúcuta, la ciudad más poblada y núcleo del área metropolitana junto a Los Patios, Villa del Rosario y otros municipios cercanos, y su geografía comprende desde la Cordillera Oriental hasta valles y llanuras, bordeados por las cuencas de los ríos Catatumbo, Pamplonita y Zulia.

```{r}


# Se filtran los departamentos para obtenr solo los que pertenecen a Norte de Santander
# El filtro se hace por el código el cual es 54
norte_santander <- mapa %>%
  filter(DPTO_CCDGO == "54")

#Transformar el objeto espacial
norte_santander <- st_transform(norte_santander, crs = 4326)
```

```{r}
# Archivo con todos los municipios de colombia
municipiosDistancia <- read.csv("DistanciaCapital/municipios.csv") 

#Se filtra por departamento y se elimina el 54 del código del municipio
municipiosDistancia <- municipiosDistancia %>%
  filter(Código.Departamento == "54") %>%
  mutate(Código.Municipio = str_sub(as.character(Código.Municipio), 3, 5))

#Se convierte en tipo númerico las coordenadas
municipiosDistancia <- municipiosDistancia %>%
  mutate(
    longitud = as.numeric(gsub(",", ".", longitud)),
    Latitud = as.numeric(gsub(",", ".", Latitud))
  )
```

## Municipios del departamento Norte de Santander

```{r}
#Se grafica el mapa con los municipios 
ggplot(norte_santander) +
  geom_sf(fill = "lightblue", color = "gray40") +
  labs(title = "Mapa de municipios") +
  theme_minimal()
```

## Distancia de los municipios a la capital

En la siguiente visualización se presenta un mapa interactivo en el que, al hacer clic sobre cada municipio, se despliega información del mismo. Adicionalmente, se incluye una escala de colores que representa la distancia de cada municipio con respecto a la capital departamental.

```{r}
# Se hace un join por el código del municipio para graficar los puntos dentro de cada municipio
norte_santander_distancia <- norte_santander %>%
  left_join(municipiosDistancia, by = c("MPIO_CCDGO" = "Código.Municipio"))

#Convertir longitud y latitud en coordenadas
municipios_puntos <- st_as_sf(municipiosDistancia,
                              coords = c("longitud", "Latitud"),
                              crs = 4326)
municipios_puntos <- st_transform(municipios_puntos, crs = st_crs(norte_santander))

#Crear una columna con la distancia a la capital
```

```{r}


# Aseguramos que coord_capital sea un vector numérico c(long, lat)
coord_capital <- c(
  norte_santander_distancia$longitud[norte_santander_distancia$MPIO_CCDGO == "001"],
  norte_santander_distancia$Latitud[norte_santander_distancia$MPIO_CCDGO == "001"]
)

norte_santander_distancia <- norte_santander_distancia %>%
  rowwise() %>%
  mutate(distancia_km = distHaversine(
    matrix(c(longitud, Latitud), nrow = 1),
    matrix(coord_capital, nrow = 1)
  ) / 1000) %>%
  ungroup()
```

```{r}

# Crear paleta de colores basada en la distancia
paleta_distancia <- colorNumeric(
  palette = colorRampPalette(c("green", "yellow", "red"))(100),  
  domain = norte_santander_distancia$distancia_km,
  reverse = FALSE
)

leaflet(norte_santander_distancia) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(
    fillColor = ~paleta_distancia(distancia_km),  
    color = "gray",
    weight = 1,
    fillOpacity = 0.7,
    popup = ~paste0(
      "<strong>Código municipio: </strong>", MPIO_CCDGO, "<br>",
      "<strong>Nombre municipio: </strong>", Nombre.Municipio, "<br>",
      "<strong>Tipo: </strong>", Tipo..Municipio...Isla...Área.no.municipalizada, "<br>",
      "<strong>Latitud: </strong>", Latitud, "<br>",
      "<strong>Longitud: </strong>", longitud, "<br>",
      "<strong>Distancia a la capital en KM: </strong>", round(distancia_km, 2), "<br>"
    ),
    label = ~MPIO_CNMBR
  ) %>%
  addCircleMarkers(
    data = municipios_puntos,  
    color = "gray",
    radius = 4,
    stroke = TRUE,
    fillOpacity = 0.9
  ) %>%
  addLegend(
    "bottomright",
    pal = paleta_distancia,
    values = ~distancia_km,
    title = "Dist Capital (km)",
    opacity = 1
  )
```

# Referencias

Linea Base. (2024, March 12). *Descarga shape municipios de Colombia*. https://lineabase.com.co/shape-municipios-colombia/

*DIVIPOLA- Códigos municipios \| Datos Abiertos Colombia*. (2025, Jan 27). https://www.datos.gov.co/d/gdxc-w37w

Wikipedia. (2025, June 26). *Norte de Santander*. Wikipedia, La Enciclopedia Libre. https://es.wikipedia.org/wiki/Norte_de_Santander
